webpackJsonp([15],{"8JpL":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n("Xxa5"),s=n.n(i),a=n("exGp"),o=n.n(a),r={sensorInfNow:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{name:"温度",unit:"℃"},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return{title:{text:t.name+"数据仪表图",x:"center"},tooltip:{formatter:"{a} <br/>{b} : {c} "+t.unit},toolbox:{feature:{}},splitNumber:e,series:[{min:n-s/(e-4)*2,max:i+s/(e-4)*2,splitNumber:e,name:t.name,type:"gauge",detail:{formatter:"{value} "+t.unit},axisLine:{show:!0,lineStyle:{color:[[2/e,"#ec2a25"],[(e-2)/e," #47e64f"],[1,"#ec2a25"]]}},data:[{value:(i-n)/2+n,name:"当前"+t.name}],markPoint:{clickable:!1,symbol:"circle",symbolSize:5,data:[{x:"center",y:"center",itemStyle:{color:"#FFF"}}]},axisLabel:{show:!0,formatter:function(t){return t.toFixed(1)},textStyle:{color:"auto"}},axisTick:{splitNumber:15}}]}},sensorInfHis:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{name:"温度",unit:"℃"},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{show:!1,start:0},s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"数据历史记录曲线图";return{title:{text:t.name+s,x:"center"},tooltip:{formatter:"{a} <br/>时间:{b}<br/>数据:{c} "+t.unit},toolbox:{show:!0,feature:{mark:{show:!0},dataView:{show:!0,readOnly:!1},restore:{show:!0},saveAsImage:{show:!0}}},dataZoom:i,xAxis:{name:"时间",boundaryGap:!1,type:"category",axisLabel:{margin:8},axisTick:{show:!0,interval:0},data:e},yAxis:{name:t.name+" ("+t.unit+")",type:"value"},grid:{},series:[{data:n,type:"line",smooth:!0,symbolSize:8,name:t.name}]}}},c={data:function(){return{sensorInfVisible:!1,NowAndHistory:0,typenum:0,oldtypenum:0,restypenum:0,items:[],sensorInf:{max:35,min:26,now:24,type:"温度|气压"},typeCheckData:[],initData:[{url:"Sensor/selectAddress.action",title:"农场"},{url:"Sensor/selectGreenHouse.action",title:"大棚"},{url:"Sensor/selectGreenHouseEquipment.action",title:"设备"},{url:"Sensor/selectSensor.action",title:"传感器"}]}},mounted:function(){this.loginThisItems(this.initData[this.typenum].url)},methods:{loginItems:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=this,i=n.typenum;if(""!=e&&(n.typeCheckData[i]=e),i==n.initData.length-1)if(t>0)n.NowAndHistory=0,n.drawChartNow();else if(t<0&&n.sensorInfVisible)return n.sensorInfVisible=!1,void(n.NowAndHistory=!0);n.oldtypenum=i,t>0?i+=1:i-=1,n.restypenum=i,i<=n.initData.length-1?n.loginThisItems(n.initData[i].url,""!=e?e.id:0==i?"":n.typeCheckData[i].id):n.typenum=n.initData.length-1},loginThisItems:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=this;n.$axios.post(n.HOST+t,""!=e?{id:e}:{id:"2"}).then(function(t){t.data.length>0?(n.items=t.data,n.typenum=n.restypenum):n.typenum=n.oldtypenum}).catch(function(t){})},watchDraw:function(t){0==t?this.drawChartNow():1==t?this.drawChartHistory():this.drawDataPrediction(),this.NowAndHistory=t},drawChartNow:function(){var t,e=(t=o()(s.a.mark(function t(){return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n.$axios.post(n.HOST+"/collect/selectParameter.action",{sensor_id:n.typeCheckData[n.typenum].id}).then(function(t){l.series[0].data[0].value=t.data.sensorValue,i.setOption(l,!0)}).catch(function(t){});case 1:case"end":return t.stop()}},t,this)})),function(){return t.apply(this,arguments)}),n=this,i=n.$echarts.init(document.getElementById("myChartNow")),a=10,c=n.drawChartSensorType(0),l={};e().then(function(t){console.log(t.data),n.sensorInf=t.data;var e=t.data.min,s=t.data.max,o=s-e;o>10||o<6?o>10&&o<20&&(a=10):o<=10&&o>=6&&(a=o+4),l=r.sensorInfNow(c,a,e,s,o),i.setOption(l,!0);var d=setInterval(function(){0==n.NowAndHistory&&n.typenum==n.initData.length-1?n.$axios.post(n.HOST+"collect/selectLatest.action",{sensor_id:n.typeCheckData[n.typenum].id}).then(function(t){console.log(l.series[0].data[0]),l.series[0].data[0].value=t.data.sensorValue,console.log(l.series[0].data[0]),i.setOption(l,!0)}).catch(function(t){console.log(t)}):clearInterval(d)},1e3);n.sensorInfVisible=!0}).catch(function(t){console.log(t())})},drawChartHistory:function(){var t=this,e=t.$echarts.init(document.getElementById("myChartHistory")),n=t.drawChartSensorType(0);t.$axios.post(t.HOST+"collect/selectQuarter.action",{sensor_id:t.typeCheckData[t.typenum].id}).then(function(i){var s=[],a=[];i.data.list.forEach(function(e){s.push(t.$api.opreate.DateCompletion(e.collectTime)),a.push(e.sensorValue)});var o=r.sensorInfHis(n,s,a,{show:!0,start:70});e.setOption(o,!0)}).catch(function(t){})},drawDataPrediction:function(){var t=this,e=t.$echarts.init(document.getElementById("myChartHistory")),n=t.drawChartSensorType(0);t.$axios.post(t.HOST+"predict/predictOneDay.action",{sensor_id:t.typeCheckData[t.typenum].id}).then(function(i){console.log(i);var s=[],a=[];i.data.list.forEach(function(e){s.push(t.$api.opreate.DateCompletion(e.collectTime)),a.push(e.sensorValue)});var o=r.sensorInfHis(n,s,a,{},"数据预测曲线图");e.setOption(o,!0)}).catch(function(t){})},drawChartSensorType:function(t){return[{unit:"℃",name:"温度"},{unit:"Pa",name:"气压"},{unit:" %RH",name:"湿度"}][t]}}},l={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"panel panel-info"},[n("div",{staticClass:"panel-body"},[n("div",[t._v("实时监测")]),t._v(" "),n("div",[n("div",{staticClass:"panel panel-default"},[n("div",{staticClass:"panel-heading"},[n("div",[n("h4",[t._l(t.typeCheckData,function(e,i){return n("span",{directives:[{name:"show",rawName:"v-show",value:i<t.typenum,expression:"index<typenum"}],key:i,class:["iconfont",{"icon-farm":0==i,"icon-greenHouse":1==i,"icon-device":2==i,"icon-sensor":3==i}],domProps:{innerHTML:t._s(e.name+"&nbsp;&nbsp;&nbsp;&nbsp;")}})}),t._v(" "),n("span",{class:["iconfont",{"icon-farm":0==t.typenum,"icon-greenHouse":1==t.typenum,"icon-device":2==t.typenum,"icon-sensor":3==t.typenum}],domProps:{innerHTML:t._s(t.initData[t.typenum].title)}}),t._v(" "),0!=t.typenum?n("a",{staticClass:"btn btn-link pull-right",on:{click:function(e){t.loginItems(-1)}}},[t._v("返回上一级")]):t._e()],2)])]),t._v(" "),n("div",{staticClass:"panel-body"},[n("div",{directives:[{name:"show",rawName:"v-show",value:!t.sensorInfVisible,expression:"!sensorInfVisible"}]},[t.items.length>0?n("div",t._l(t.items,function(e,i){return n("div",{key:i,staticClass:"col-sm-3 col-md-3 col-lg-2"},[n("div",{staticClass:"item-back",on:{click:function(n){t.loginItems(1,e)}}},[n("div",{staticClass:"real-item"},[n("div",{staticClass:"real-icon"},[n("i",{staticClass:"iconfont ",class:["iconfont",{"icon-farm":0==t.typenum,"icon-greenHouse":1==t.typenum,"icon-device":2==t.typenum,"icon-sensor":3==t.typenum}]})]),t._v(" "),n("div",{staticClass:"real-info"},[n("span",{domProps:{innerHTML:t._s(e.name)}}),n("br"),t._v(" "),n("span",{domProps:{innerHTML:t._s(e.address)}})])])])])})):t._e(),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.items.length<=0,expression:"items.length<=0"}],staticClass:"col-sm-12 txt-center cursor-pointer logindata-error"},[t._v("\r\n                                未查找到数据，点击请重试\r\n                            ")])]),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.sensorInfVisible,expression:"sensorInfVisible"}]},[n("div",{staticClass:"pull-right"},[n("a",{directives:[{name:"show",rawName:"v-show",value:0!=t.NowAndHistory,expression:"NowAndHistory!=0"}],staticClass:"btn btn-link",on:{click:function(e){t.watchDraw(0)}}},[t._v("查看当前数据")]),t._v(" "),n("a",{directives:[{name:"show",rawName:"v-show",value:1!=t.NowAndHistory,expression:"NowAndHistory!=1"}],staticClass:"btn btn-link",on:{click:function(e){t.watchDraw(1)}}},[t._v("查看历史记录")]),t._v(" "),n("a",{directives:[{name:"show",rawName:"v-show",value:2!=t.NowAndHistory,expression:"NowAndHistory!=2"}],staticClass:"btn btn-link",on:{click:function(e){t.watchDraw(2)}}},[t._v("查看数据预测")])]),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:0==t.NowAndHistory,expression:"NowAndHistory==0"}]},[n("div",{style:{width:"600px",height:"500px",margin:"auto"},attrs:{id:"myChartNow"}})]),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:1==t.NowAndHistory||2==t.NowAndHistory,expression:"NowAndHistory==1||NowAndHistory==2"}]},[n("div",{style:{width:"800px",height:"500px",margin:"auto"},attrs:{id:"myChartHistory"}})])])])])])])])])},staticRenderFns:[]};var d=n("VU/8")(c,l,!1,function(t){n("ezZ2")},"data-v-4f80c14c",null);e.default=d.exports},ezZ2:function(t,e){}});
//# sourceMappingURL=15.198cfc00949a682c5146.js.map